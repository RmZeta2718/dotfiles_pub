#!/bin/bash

CMD="rsync -avhH --partial-dir=.rsync-partial --exclude '__pycache__/' --delete"

COLOR_RESET="\033[0m"
BOLD_TEXT="\033[1m"
UNDERLINE_TEXT="\033[4m"

if [[ "$#" -lt 2 || "$#" -gt 3 ]]; then
    echo "rsync_push: push project folder to host"
    echo "Usage: $0 <local_folder> <hostname> [remote_path]"
    exit 1
fi
local_folder=$(realpath $1)
host=$2
remote_path=$(dirname $local_folder)  # dst does not contain basename

if [[ "$#" -eq 3 ]]; then
    remote_path=$(dirname $(realpath $3))  # overwrite
fi

# Prompt for confirmation
echo -en "Sync: $BOLD_TEXT$UNDERLINE_TEXT$local_folder$COLOR_RESET -> $host:$BOLD_TEXT$UNDERLINE_TEXT$remote_path$COLOR_RESET? [Y/n] " 
read -r

# Execute rsync if the user confirms or doesn't enter anything
if [[ $REPLY =~ ^[Yy]$ ]] || [[ -z $REPLY ]]; then
    $CMD $local_folder $host:$remote_path
fi
