- defaults:
    shell:
      stdin: true
      stdout: true
      stderr: true
    clean:
      recursive: true # must turn off in ~/
    link:
      create: true
      # relink: true # if this repo is moved, uncomment and install to relink dotfiles

- shell:
    - [bash apt_install.sh, "Install apt packages."]
    - [
        if test "$(basename -- "$SHELL")" != "zsh"; then chsh -s $(which zsh); fi,
        "Change default shell.",
      ]
    - [git submodule sync --recursive, "Sync submodule"]
    - [git submodule update --init --recursive, "Init submodule"]
    - [(cd autojump && ./install.py), "Install autojump"] # https://github.com/wting/autojump#manual

# ssh file permissions, see https://superuser.com/a/1559867
- create:
    ~/.ssh:
      mode: 0700
- shell:
    - chmod 600 ssh/config # git does not track file mode (other than exec bit)

- clean:
    ~/:
      recursive: false
# recursive paths
- clean:
    - "~/.config"
    - "~/.ssh"
    - "~/.oh-my-zsh"

- link:
    ~/.dotfiles: "" # link itself

    ~/.shell:
    ~/.zshrc: zsh/zshrc
    ~/.oh-my-zsh: zsh/oh-my-zsh
    ~/.oh-my-zsh/custom/plugins/:
      path: zsh/custom/plugins/*
      glob: true

    # TODO
    # ~/.config:
    # ~/.vim

    ~/.ssh/config: ssh/config

    ~/.config/clash/Country.mmdb: clash/Country.mmdb

    ~/.pythonrc:
    ~/.gitconfig:
